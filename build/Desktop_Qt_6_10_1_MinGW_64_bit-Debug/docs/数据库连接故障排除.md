# 数据库连接故障排除指南

## 你的数据库信息
- **主机**: localhost
- **用户名**: root  
- **密码**: 123456
- **数据库名**: hospital_db

## 解决步骤

### 1. 检查 MySQL 服务状态

**Windows 系统:**
```cmd
# 检查 MySQL 服务是否运行
net start | findstr MySQL

# 如果没有运行，启动 MySQL 服务
net start MySQL80  # 或者 MySQL57, MySQL 等，取决于你的版本
```

**或者通过服务管理器:**
1. 按 `Win + R`，输入 `services.msc`
2. 找到 MySQL 服务
3. 右键点击 -> 启动

### 2. 测试数据库连接

打开命令行，测试连接：
```cmd
mysql -h localhost -u root -p123456
```

如果连接成功，你会看到 MySQL 提示符。

### 3. 创建数据库

在 MySQL 命令行中执行：
```sql
CREATE DATABASE IF NOT EXISTS hospital_db;
SHOW DATABASES;
```

### 4. 或者执行 SQL 脚本

```cmd
mysql -h localhost -u root -p123456 < database_setup.sql
```

### 5. 检查 Qt MySQL 驱动

确保你的 Qt 安装包含 MySQL 驱动。在应用程序中添加调试代码：

```cpp
// 在 main.cpp 或 mainwindow.cpp 中添加
qDebug() << "Available SQL drivers:" << QSqlDatabase::drivers();
```

应该看到 "QMYSQL" 在列表中。

## 常见错误及解决方案

### 错误 1: "QSqlDatabase: QMYSQL driver not loaded"
**解决方案:**
- 重新安装 Qt，确保选择 MySQL 支持
- 或者下载 MySQL 驱动文件放到 Qt 安装目录

### 错误 2: "Access denied for user 'root'@'localhost'"
**解决方案:**
```sql
-- 重置 root 密码
ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
FLUSH PRIVILEGES;
```

### 错误 3: "Can't connect to MySQL server on 'localhost'"
**解决方案:**
- 确保 MySQL 服务正在运行
- 检查端口 3306 是否被占用
- 尝试使用 127.0.0.1 而不是 localhost

### 错误 4: "Unknown database 'hospital_db'"
**解决方案:**
- 手动创建数据库，或者
- 程序会自动提示创建数据库

## 验证连接成功

如果一切正常，应用程序启动时会显示：
- 不会出现数据库连接错误对话框
- 患者页面可以正常显示数据
- 可以添加、编辑、删除患者信息

## 需要帮助？

如果仍然无法连接，请提供以下信息：
1. MySQL 版本
2. Qt 版本
3. 具体的错误消息
4. 操作系统版本

## 快速测试脚本

创建一个简单的测试文件 `test_connection.cpp`:

```cpp
#include <QApplication>
#include <QSqlDatabase>
#include <QSqlError>
#include <QDebug>

int main(int argc, char *argv[])
{
    QApplication app(argc, argv);
    
    qDebug() << "Available drivers:" << QSqlDatabase::drivers();
    
    QSqlDatabase db = QSqlDatabase::addDatabase("QMYSQL");
    db.setHostName("localhost");
    db.setUserName("root");
    db.setPassword("123456");
    db.setDatabaseName("hospital_db");
    
    if (db.open()) {
        qDebug() << "Connection successful!";
    } else {
        qDebug() << "Connection failed:" << db.lastError().text();
    }
    
    return 0;
}
```