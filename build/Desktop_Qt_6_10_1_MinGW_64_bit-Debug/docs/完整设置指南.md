# Qt 医院管理系统 - 完整设置指南

## 📋 你的配置信息
- **数据库主机**: localhost
- **用户名**: root
- **密码**: 123456
- **数据库名**: hospital_db

## 🚀 快速设置 (推荐)

### 步骤 1: 设置数据库
双击运行 `setup_database.bat`，这个脚本会：
- 检查 MySQL 服务状态
- 自动启动 MySQL 服务
- 创建数据库和表
- 插入示例数据

### 步骤 2: 测试数据库连接
双击运行 `test_connection.bat`，验证数据库连接是否正常。

### 步骤 3: 编译和运行项目
双击运行 `build_and_run.bat`，自动编译并启动程序。

## 🔧 手动设置

### 1. 环境要求
- **Qt 5.12+ 或 Qt 6.x**
- **MySQL 5.7+ 或 8.0+**
- **Visual Studio 2019+ 或 MinGW**

### 2. 安装 MySQL
如果还没有安装 MySQL：
1. 下载 [MySQL Community Server](https://dev.mysql.com/downloads/mysql/)
2. 安装时设置 root 密码为 `123456`
3. 确保服务自动启动

### 3. 配置 Qt
确保 Qt 安装包含：
- Qt Charts 模块
- Qt SQL 模块
- MySQL 数据库驱动

### 4. 创建数据库
```sql
-- 方法 1: 使用命令行
mysql -u root -p123456 -e "CREATE DATABASE hospital_db;"

-- 方法 2: 执行 SQL 脚本
mysql -u root -p123456 < database_setup.sql
```

### 5. 编译项目
```bash
# 在项目目录中
qmake Hospital.pro
make  # 或 nmake (Windows)
```

## 🐛 故障排除

### 问题 1: "QSqlDatabase: QMYSQL driver not loaded"
**解决方案:**
1. 重新安装 Qt，确保选择 MySQL 支持
2. 检查 Qt 安装目录下是否有 MySQL 驱动文件
3. 运行测试程序检查可用驱动

### 问题 2: "Access denied for user 'root'@'localhost'"
**解决方案:**
```sql
-- 重置密码
ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
FLUSH PRIVILEGES;
```

### 问题 3: "Can't connect to MySQL server"
**解决方案:**
1. 检查 MySQL 服务是否运行：`net start | findstr MySQL`
2. 启动服务：`net start MySQL80`
3. 检查端口 3306 是否被占用

### 问题 4: "Unknown database 'hospital_db'"
**解决方案:**
运行 `setup_database.bat` 或手动创建数据库

## 📁 项目文件说明

| 文件 | 说明 |
|------|------|
| `Hospital.pro` | Qt 项目文件 |
| `mainwindow.cpp/h` | 主窗口实现 |
| `databasemanager.cpp/h` | 数据库管理类 |
| `patientdialog.cpp/h` | 患者信息对话框 |
| `database_setup.sql` | 数据库初始化脚本 |
| `setup_database.bat` | 自动数据库设置脚本 |
| `build_and_run.bat` | 自动编译运行脚本 |
| `test_connection.bat` | 数据库连接测试脚本 |

## 🎯 功能验证

程序启动后，你应该能够：
1. 看到患者管理界面
2. 添加新患者信息
3. 编辑现有患者
4. 删除患者记录
5. 搜索患者信息
6. 查看统计图表

## 📞 获取帮助

如果仍然遇到问题：
1. 查看 `数据库连接故障排除.md`
2. 运行 `test_connection.bat` 获取详细错误信息
3. 检查 MySQL 错误日志
4. 确认 Qt 版本和 MySQL 版本兼容性

## 🔄 更新数据库配置

如果需要修改数据库连接信息，编辑 `mainwindow.cpp` 中的 `setupDatabase()` 函数：

```cpp
QString host = "localhost";        // 修改主机地址
QString database = "hospital_db";  // 修改数据库名
QString username = "root";         // 修改用户名
QString password = "123456";       // 修改密码
```

## ✅ 成功标志

当一切设置正确时，你会看到：
- 程序启动无错误对话框
- 患者列表显示示例数据
- 所有功能按钮可正常使用
- 数据库操作响应正常